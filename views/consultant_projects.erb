<div class="container theme-showcase" role="main">
  <div class="page-header">
    <h2>Consultant <small>(<%= consultant.email %> )</small></h2>
  </div>
  <div class="container-fluid">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <strong>Details</strong>
      </div>
      <table id="consultantDetails" class="table table-striped" style="table-layout: fixed; word-wrap: break-word">
        <tr>
          <td width="35%"><strong>First Name</strong></td>
          <td width="65%">
            <a href="#" id="firstname"></a>
           </td>
        </tr>
        <tr>
          <td width="35%"><strong>Last Name</strong></td>
          <td width="65%">
            <a href="#" id="lastname"><%= consultant.last_name %></a>
          </td>
        </tr>
        <tr>
          <td width="35%"><strong>Team</strong></td>
          <td width="65%">
            <a href="#" id="team"><%= consultant.team || 'Ask Admin to Update' %></a>
          </td>
        </tr>
        <tr>
          <td width="35%"><strong>Current Company</strong></td>
          <td width="65%">
            <a href="#" id="company"><%= details.current_company %></a>
          </td>
        </tr>
        <tr>
          <td width="35%"><strong>Certifications</strong></td>
          <td width="65%">
            <a href="#" id="certifications"><%= details.certifications.join(',') %></a>
          </td>
        </tr>
        <tr>
          <td width="35%"><strong>Trainings</strong></td>
          <td width="65%">
            <a href="#" id="trainings" data-type="select2" data-pk="<%= details.consultant_id %>" data-value="<%= details.trainings && details.trainings.join(',') || '' %>" data-url="/consultant/details/update" data-title="Enter your trainings"></a>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

<div class="container theme-showcase" role="main">
  <div class="page-header">
    <h2>Your Projects <small>(we appreciate if you could let us know what is that you are working on)</small>
      <p class="pull-right">
        <a id="AddProject" class="btn btn-primary btn-md" href="/consultant/<%= consultant.email %>/projects/add" role="button">Add Project &raquo;</a>
      </p>
    </h2>
  </div>
  <div class="container-fluid">
    <!-- projects -->
    <% if details.has_projects? %>
      <% details.projects.each do |project| %>
        <div class="row-fluid">
          <div class="span12">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <strong><%= project.name %></strong>
              </div>
              <div class="row-fluid">
                <div class="span12">
                  <div class="row-fluid"> <!-- container for table and resumes -->
                    <br \>
                    <div class="span7">
                      <!-- table for showing project details -->
                      <div class="panel panel-default">
                        <table id="projectDetails" class="table table-bordered table-striped" style="table-layout: fixed; word-wrap: break-word">
                          <tr>
                            <td width="35%"><strong>Client</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>client"><%= project.client %></a>
                             </td>
                          </tr>
                          <tr>
                            <td width="35%"><strong>Title</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>title"><%= project.title %></a>
                             </td>
                          </tr>
                          <tr>
                            <td width="35%"><strong>Duration</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>duration"><%= project.duration || 0 %></a>
                             </td>
                          </tr>
                          <tr>
                            <td width="35%"><strong>Software Used</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>software"><%= project.software.join(', ') %></a>
                             </td>
                          </tr>
                          <tr>
                            <td width="35%"><strong>Management Tools</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>software"><%= project.management_tools.join(', ') %></a>
                             </td>
                          </tr>
                          <tr>
                            <td width="35%"><strong>Commercial Support</strong></td>
                            <td width="65%">
                              <a id="<%= project.name %>software"><%= project.commercial_support.join(', ') %></a>
                             </td>
                          </tr>
                        </table>
                      </div>
                    </div> <!-- span 7 -->
                    <div class="span4"> <!-- files -->
                      <div class="panel panel-info">
                        <div class="panel-heading">
                          <a>
                            <% document_count = ( project.illustrations.count || 0 ) + ( project.projectdocuments.count || 0 ) %>
                            <span class="badge pull-right uploadprojectfilescount" data-original-title="Number of files uploaded"><%= document_count %></span>
                            <a href="#">
                              <span class="badge badge-important pull-right uploadprojectfiles" data-original-title="Upload files to the project"><i class="fa fa-cloud-upload"></i></span>
                            </a>
                            <strong><%= project.name %> Files</strong>
                          </a>
                        </div>
                        <% if document_count == 0 %>
                          <p class="text-center">No files have been uploaded yet.</p>
                        <% else %>
                        <ul class="list-group">
                          <% project.illustrations.each do |illustartion| %>
                          <li class="list-group-item">
                            <%= illustartion.filename && illustartion.filename.split('_', 4).last %>
                          </li>
                          <% end %>
                          <% project.projectdocuments.each do |document| %>
                          <li class="list-group-item">
                            <%= document.filename && document.filename.split('_', 4).last %>
                          </li>
                          <% end %>
                        </ul>
                        <% end %>
                      </div> <!-- end files panel-->
                    </div> <!-- span4 -->
                  </div> <!-- end container for table and resumes -->
                </div> <!-- end span12 -->
              </div> <!-- row-fluid -->
              <div class="row-fluid">
                <div class="span12">
                  <hr>
                  <% if project.has_usecases? %>
                    <div class="col-xs-2"> <!-- required for floating -->
                      <!-- Nav tabs -->
                      <ul class="nav nav-tabs tabs-left">
                        <% project.usecases.each_with_index do |usecase, index| %>
                          <% if index == 0 %>
                          <li class="active"><a href="#<%= project.name + usecase.name %>" data-toggle="tab"><%= usecase.name %></a></li>
                          <% else %>
                          <li><a href="#<%= project.name + usecase.name %>" data-toggle="tab"><%= usecase.name %></a></li>
                          <% end %>
                        <% end %>
                      </ul>
                    </div>

                    <div class="col-xs-9">
                      <!-- Tab panes -->
                      <div class="tab-content">
                        <% project.usecases.each_with_index do |usecase, index| %>
                        <% if index == 0 %>
                        <div class="tab-pane active" id="<%=  project.name + usecase.name %>">
                        <% else %>
                        <div class="tab-pane" id="<%=  project.name + usecase.name %>">
                        <% end %>
                          <div class="panel panel-default">
                            <table id="usecase<%= usecase.name %>" class="table table-bordered table-striped" style="table-layout: fixed; word-wrap: break-word">
                              <tr>
                                <td width="25%"><strong>Usecase Name</strong></td>
                                <td width="75%">
                                  <!-- <a href="#" id="usecasename"></a> -->
                                  <%= usecase.name %>
                                 </td>
                              </tr>
                              <tr>
                                <td width="25%"><strong>Usecase Description</strong></td>
                                <td width="75%">
                                  <%= usecase.description %>
                                </td>
                              </tr>
                            </table>
                          </div>
                          <% usecase.requirements.each do |requirement| %>
                            <div class="panel panel-default">
                              <div class="panel-heading">
                                <a><b><%= usecase.name %> Requirements</b></a>
                              </div>
                              <table id="requirement<%= requirement.id %>" class="table table-striped" style="table-layout: fixed; word-wrap: break-word">
                                <tr>
                                  <td width="25%">Requirement</td>
                                  <td width="75%">
                                    <%= requirement.requirement %>
                                  </td>
                                </tr>
                                <tr>
                                  <td width="25%">Approach</td>
                                  <td width="75%">
                                    <%= requirement.approch %>
                                  </td>
                                </tr>
                                <tr>
                                  <td width="25%">Effort</td>
                                  <td width="75%">
                                    <%= requirement.effort %>
                                  </td>
                                </tr>
                                <tr>
                                  <td width="25%">Tools</td>
                                  <td width="75%">
                                    <%= requirement.tools.join(', ') %>
                                  </td>
                                </tr>
                                <tr>
                                  <td width="25%">Resources</td>
                                  <td width="75%">
                                    <%= requirement.resources %>
                                  </td>
                                </tr>
                                <tr>
                                  <td width="25%">Insights</td>
                                  <td width="75%">
                                    <%= requirement.insights %>
                                  </td>
                                </tr>
                              </table>
                            </div>
                          <% end %>
                        </div> <!-- end tab pane -->
                        <% end %>
                      </div> <!-- end tab content -->
                    </div>
                  </div>
                  <p class="text-center text-danger">Note: Inline editing of projects and usecases is in progress.</p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %> <!-- end projects -->
    <% else %>
      <div class="bs-callout bs-callout-info">
        <p class="lead">You havn't added any projects yet. Add projects using <code>'Add Project'</code> button</p>
      </div>
    <% end %>
  </div>
</div>

<script>
$(document).ready(function() {
  // tooltip for project files upload
  $('.uploadprojectfiles').tooltip();
  $('.uploadprojectfilescount').tooltip();

  // inline editing
  $.fn.editable.defaults.mode = 'inline';
  $.fn.editable.defaults.ajaxOptions = {type: "POST"};

  //make username editable
  $('#firstname').editable({
    type: 'text',
    title: 'Enter firstname',
    placement: 'right',
    value: '<%= consultant.first_name %>', // initial value, will be updated and send to server side upon change
    url: '/consultant/update',
    pk: '<%= consultant.email %>', // primary key (mongo _id)
    name: 'first_name', // mongo doc_key being update
    validate: function(value) {
       if($.trim(value) == '') return 'This field is required';
    },
    success: function(response, newValue) {
      if(!response.status) return response.msg;
    },
  });

  $('#lastname').editable({
    type: 'text',
    title: 'Enter lastname',
    placement: 'right',
    value: '<%= consultant.last_name %>',
    url: '/consultant/update',
    pk: '<%= consultant.email %>',
    name: 'last_name',
    success: function(response, newValue) {
      if(!response.status) return response.msg;
    },
  });

  //make status editable
  <% if @admin_user %>
  $('#team').editable({
      type: 'text',
      title: 'Enter user team',
      placement: 'right',
      value: '<%= consultant.team %>',
      // source: '/consultant/teams', // fetch the teams avaiable from remote url
      pk: '<%= consultant.email %>',
      name: 'team',
      url: '/consultant/update',
      success: function(response, newValue) {
        if(!response.status) return response.msg;
      },
  });
  <% end %>

  $('#company').editable({
    type: 'text',
    title: 'Select your current company',
    placement: 'right',
    value: '<%= details.current_company %>',
    url: '/consultant/details/update',
    pk: '<%= details.consultant_id %>',
    name: 'current_company',
    success: function(response, newValue) {
      if(!response.status) return response.msg;
    }
  });

  $("#certifications").editable({
    type: 'checklist',
    title: 'Update your certifications',
    placement: 'right',
    url: '/consultant/details/update',
    separator: ',', // used to seperate values as arary from data-value
    source: '/deatils/certifications/possible_values',
    pk: '<%= details.consultant_id %>',
    name: 'certifications',
    success: function(response, newValue) {
      if(!response.status) return response.msg;
    },
  });

  $("#trainings").editable({
    type: 'select2',
    tpl: "<input type='text' style='width: 400px'>",
    inputclass: 'input-large',
    placement: 'right',
    select2: {
      tags: ['Mongodb Developer', 'Mongodb Admin']
    }
  });

});
</script>
